<div class="d-flex align-items-center mb-3">
  <a class="btn btn-outline-secondary" href="/"><i class="bi bi-arrow-left"></i></a>
  <h1 class="ms-2 mb-0">Busca</h1>
</div>

<div class="card mb-4">
  <div class="card-body">
    <form method="get" class="row g-3">
      <div class="col-12 col-md-4">
        <label class="form-label">Nome</label>
        <input type="text" class="form-control" name="q" value="<%= query.q || '' %>" placeholder="Ex.: Charizard" />
      </div>
      <div class="col-6 col-md-2">
        <label class="form-label">Condição</label>
        <select class="form-select" name="condition">
          <option value=""></option>
          <% CONDITIONS.forEach(c => { %>
            <option value="<%= c %>" <%= query.condition === c ? 'selected' : '' %>><%= c %></option>
          <% }) %>
        </select>
      </div>
      <div class="col-6 col-md-2">
        <label class="form-label">Idioma</label>
        <select class="form-select" name="language">
          <option value=""></option>
          <% LANGUAGES.forEach(l => { %>
            <option value="<%= l %>" <%= query.language === l ? 'selected' : '' %>><%= l %></option>
          <% }) %>
        </select>
      </div>
      <div class="col-6 col-md-2">
        <label class="form-label">Tipo</label>
        <select class="form-select" name="card_type">
          <option value=""></option>
          <% CARD_TYPES.forEach(t => { %>
            <option value="<%= t %>" <%= query.card_type === t ? 'selected' : '' %>><%= t %></option>
          <% }) %>
        </select>
      </div>
      <div class="col-6 col-md-2">
        <label class="form-label">Status</label>
        <select class="form-select" name="owned">
          <option value=""></option>
          <option value="true" <%= query.owned === 'true' ? 'selected' : '' %>>Na coleção</option>
          <option value="false" <%= query.owned === 'false' ? 'selected' : '' %>>Desejo</option>
        </select>
      </div>
      <div class="col-6 col-md-2">
        <label class="form-label">Nota mín</label>
        <input type="number" min="1" max="10" class="form-control" name="grading_min" value="<%= query.grading_min || '' %>" />
      </div>
      <div class="col-6 col-md-2">
        <label class="form-label">Nota máx</label>
        <input type="number" min="1" max="10" class="form-control" name="grading_max" value="<%= query.grading_max || '' %>" />
      </div>
      <div class="col-12 col-md-4 d-flex align-items-end">
        <button class="btn btn-primary me-2" type="submit"><i class="bi bi-search me-1"></i>Buscar</button>
        <a class="btn btn-outline-secondary" href="/search">Limpar</a>
      </div>
    </form>
  </div>
</div>

<div class="d-flex align-items-center mb-2">
  <div class="muted">Resultados: <strong><%= results.length %></strong></div>
</div>

<% if (!results.length) { %>
  <div class="alert alert-info">Nenhum card encontrado.</div>
<% } %>

<div class="row g-3">
  <% results.forEach(c => { %>
    <div class="col-12 col-sm-6 col-md-4 col-lg-3">
      <div class="card h-100">
        <a href="/card/<%= c.id %>/view" class="text-decoration-none">
          <img class="card-img-top" src="<%= normalizeCloudinary(c.photo_url, { width: 900, height: 1200 }) %>" alt="<%= c.name %>">
        </a>
        <div class="card-body d-flex flex-column">
          <h6 class="mb-1"><%= c.name %></h6>
          <div class="muted small">
            <div class="d-flex justify-content-between">
              <span><strong>Lista:</strong> <%= c.list_name %></span>
              <span class="badge badge-soft rounded-pill"><%= c.card_type %></span>
            </div>
            <div><strong>Nº:</strong> <%= c.collection_total ? `${c.card_number}/${c.collection_total}` : (c.card_number || '-') %></div>
            <div><strong>Idioma:</strong> <%= c.language || '-' %></div>
            <div><strong>Condição:</strong> <%= c.condition || '-' %></div>
            <div><strong>Nota:</strong> <%= c.grading_note ?? '-' %></div>
            <div>
              <strong>Status:</strong>
              <% if (c.owned) { %>
                <span class="badge bg-success-subtle text-success border">Na coleção</span>
              <% } else { %>
                <span class="badge bg-warning-subtle text-warning border">Desejo</span>
              <% } %>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% }) %>
</div>

